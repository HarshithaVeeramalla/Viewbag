@model AguasNico.Models.ViewModels.Dealers.PrintSheetViewModel
@using System.Globalization
@{
    ViewData["Title"] = "Repartidores";
}

<link href="~/lib/bootstrap-material-datetimepicker/css/bootstrap-material-datetimepicker.css" rel="stylesheet">
<link href="~/lib/datatables/media/css/dataTables.bootstrap4.css" rel="stylesheet">
<link href="~/lib/morrisjs/morris.css" rel="stylesheet">

<script src="~/lib/raphael/raphael-min.js"></script>
<script src="~/lib/morrisjs/morris.js"></script>
<script src="~/lib/datatables/datatables.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
<script src="~/lib/moment/moment-with-locales.js"></script>
<script src="~/lib/bootstrap-material-datetimepicker/js/bootstrap-material-datetimepicker.js"></script>
<script src="~/js/custom/dealers/details.js"></script>
<script src="~/js/jquery.PrintArea.js"></script>
<script src="~/js/custom/dealers/printSheet.js"></script>


<div class="container-fluid">
    <div class="row page-titles">
        <div class="col-md-5 col-8 align-self-center">
            <h3 class="text-themecolor m-b-0 m-t-0">Repartidores</h3>
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a asp-area="" asp-controller="Home" asp-action="Index">Inicio</a></li>
                <li class="breadcrumb-item"><a asp-area="" asp-controller="Dealers" asp-action="Index">Repartidores</a></li>
                <li class="breadcrumb-item"><a asp-area="" asp-controller="Dealers" asp-action="Details" asp-route-id="@Model.Dealer.Id">@Model.Dealer.Name</a></li>
                <li class="breadcrumb-item active">Planillas</li>
            </ol>
        </div>
    </div>
    @foreach (var day in new ConstantsMethods().GetDays())
    {
        if (!Model.Sheets.Any(x => x.Day == day))
        {
            continue;
        }
        <div class="printableArea px-1">
            <div class="row bg-white">
                <div class="col-12 d-flex justify-content-between">
                    <h4 class="text-center p-2 m-0">Planilla @day</h4>
                    <h4 class="text-center p-2 m-0">@Model.Dealer.Name</h4>
                </div>
                @foreach (var item in Model.Sheets.Where(x => x.Day == day))
                {
                    <div class="col-12 d-flex justify-content-between py-1 border">
                        <strong class="text-monospace text-black mb-0">
                            @item.ClientName 
                        </strong>
                        <div class="d-flex mr-4">
                            <p class="text-monospace text-black mx-5 mb-0">
                                <i class="bi bi-geo-alt pr-1"></i >@item.ClientAddress 
                            </p>
                            <p class="text-monospace text-black mb-0">
                                <i class="bi bi-telephone-fill pr-1"></i> @item.ClientPhone
                            </p>
                        </div>
                    </div>
                    <div class="col-8 px-0">
                        <div class="row">
                            @if (item.Products.Any())
                            {
                                <div class="col-12">
                                    <table class="table table-bordered border-top-0 mb-0">
                                        <thead>
                                            <tr>
                                                <th class="py-0">BAJADA</th>
                                                <th class="py-0">S1</th>
                                                <th class="py-0">S2</th>
                                                <th class="py-0">S3</th>
                                                <th class="py-0">S4</th>
                                                <th class="py-0">S5</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var product in item.Products)
                                            {
                                            <tr>
                                                <td class="py-1">
                                                    @product.Type.GetDisplayName() @Html.DisplayFor(x => product.Price)  (Stock: @product.Stock u.)
                                                </td>   
                                                <td class="py-1"></td> 
                                                <td class="py-1"></td> 
                                                <td class="py-1"></td> 
                                                <td class="py-1"></td> 
                                                <td class="py-1"></td> 
                                            </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            }
                            @if (item.AbonoProducts.Any())
                            {
                                <div class="col-12">
                                    <table class="table table-bordered border-top-0 mb-0">
                                        <thead>
                                            <tr>
                                                <th class="py-0">ABONO</th>
                                                <th class="py-0">S1</th>
                                                <th class="py-0">S2</th>
                                                <th class="py-0">S3</th>
                                                <th class="py-0">S4</th>
                                                <th class="py-0">S5</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var product in item.AbonoProducts)
                                            {
                                            <tr>
                                                <td class="py-1">
                                                    @product.Type.GetDisplayName() - @product.Available disponibles @(!item.Products.Any() ? $" (Stock: {product.Stock} u.)" : "")
                                                </td>   
                                                <td class="py-1"></td> 
                                                <td class="py-1"></td> 
                                                <td class="py-1"></td> 
                                                <td class="py-1"></td> 
                                                <td class="py-1"></td> 
                                            </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            }
                            <div class="col-12">
                                <p class="text-monospace text-black ml-3 my-2">
                                    Envases: 
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-4 d-flex flex-column">
                        <div class="d-flex flex-grow-1">
                            <p class="text-monospace mb-2 flex-grow-1 align-self-stretch">Saldo anterior: @(item.ClientDebt > 0 ? @Html.DisplayFor(x => item.ClientDebt) : $"${(item.ClientDebt * -1).ToString("#,##")} (A favor)")</p>
                        </div>
                        <div class="d-flex flex-grow-1">
                            <p class="text-monospace mb-2 flex-grow-1 align-self-stretch">Entrega:</p>
                        </div>
                        <div class="d-flex flex-grow-1">
                            <p class="text-monospace mb-2 flex-grow-1 align-self-stretch">Saldo actual:</p>
                        </div>
                    </div>
                }
            </div>
        </div>
    }
    <div class="text-right">
        <button onclick="print()" class="btn btn-info btn-outline" type="button"> <span><i class="fa fa-print"></i> Convertir a PDF</span></button>
    </div>
</div>