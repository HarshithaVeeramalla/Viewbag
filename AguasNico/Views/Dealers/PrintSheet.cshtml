@model AguasNico.Models.ViewModels.Dealers.PrintSheetViewModel
@using System.Globalization
@{
    ViewData["Title"] = "Repartidores";
}

<link href="~/lib/bootstrap-material-datetimepicker/css/bootstrap-material-datetimepicker.css" rel="stylesheet">
<link href="~/lib/datatables/media/css/dataTables.bootstrap4.css" rel="stylesheet">
<link href="~/lib/morrisjs/morris.css" rel="stylesheet">

<script src="~/lib/raphael/raphael-min.js"></script>
<script src="~/lib/morrisjs/morris.js"></script>
<script src="~/lib/datatables/datatables.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
<script src="~/lib/moment/moment-with-locales.js"></script>
<script src="~/lib/bootstrap-material-datetimepicker/js/bootstrap-material-datetimepicker.js"></script>
<script src="~/js/custom/dealers/details.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.3/jspdf.umd.min.js"></script>


<div class="container-fluid">
    <div class="row page-titles">
        <div class="col-md-5 col-8 align-self-center">
            <h3 class="text-themecolor m-b-0 m-t-0">Repartidores</h3>
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a asp-area="" asp-controller="Home" asp-action="Index">Inicio</a></li>
                <li class="breadcrumb-item"><a asp-area="" asp-controller="Dealers" asp-action="Index">Repartidores</a></li>
                <li class="breadcrumb-item"><a asp-area="" asp-controller="Dealers" asp-action="Details" asp-route-id="@Model.Dealer.Id">@Model.Dealer.Name</a></li>
                <li class="breadcrumb-item active">Planillas</li>
            </ol>
        </div>
    </div>
    <h3 class="text-center">Lunes</h3>
    <div class="row bg-white" id="contentToConvert">
        @foreach (var item in Model.MondaySheets)
        {
            <div class="col-12 d-flex justify-content-between py-1 border">
                <strong class="text-monospace text-black mb-0">
                    @item.ClientName 
                </strong>
                <div class="d-flex mr-4">
                    <p class="text-monospace text-black mx-5 mb-0">
                        <i class="bi bi-geo-alt pr-1"></i >@item.ClientAddress 
                    </p>
                    <p class="text-monospace text-black mb-0">
                        <i class="bi bi-telephone-fill pr-1"></i> @item.ClientPhone
                    </p>
                </div>
            </div>
            <div class="col-8 px-0">
                <div class="row">
                    <div class="col-12">
                        <table class="table table-bordered border-top-0 mb-0">
                            <thead>
                                <tr>
                                    <th class="py-0">BAJADA</th>
                                    <th class="py-0">S1</th>
                                    <th class="py-0">S2</th>
                                    <th class="py-0">S3</th>
                                    <th class="py-0">S4</th>
                                    <th class="py-0">S5</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var product in item.Products)
                                {
                                <tr>
                                    <td class="py-1">
                                        @product.Type.GetDisplayName() @Html.DisplayFor(x => product.Price)  (Stock: @product.Stock u.)
                                    </td>   
                                    <td class="py-1"></td> 
                                    <td class="py-1"></td> 
                                    <td class="py-1"></td> 
                                    <td class="py-1"></td> 
                                    <td class="py-1"></td> 
                                </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                    @if (item != null && item.AbonoProducts != null && item.AbonoProducts.Any())
                    {
                    <div class="col-12">
                        <table class="table table-bordered border-top-0 mb-0">
                            <thead>
                                <tr>
                                    <th class="py-0">ABONO</th>
                                    <th class="py-0">S1</th>
                                    <th class="py-0">S2</th>
                                    <th class="py-0">S3</th>
                                    <th class="py-0">S4</th>
                                    <th class="py-0">S5</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var product in item.AbonoProducts)
                                {
                                <tr>
                                    <td class="py-1">
                                        @product.Type.GetDisplayName() - @product.Available disponibles
                                    </td>   
                                    <td class="py-1"></td> 
                                    <td class="py-1"></td> 
                                    <td class="py-1"></td> 
                                    <td class="py-1"></td> 
                                    <td class="py-1"></td> 
                                </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                    }
                    <div class="col-12">
                        <p class="text-monospace text-black ml-3 my-2">
                            Envases: 
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-4 d-flex flex-column">
                <div class="d-flex flex-grow-1">
                    <p class="text-monospace mb-2 flex-grow-1 align-self-stretch">Saldo anterior: $@item.ClientPhone</p>
                </div>
                <div class="d-flex flex-grow-1">
                    <p class="text-monospace mb-2 flex-grow-1 align-self-stretch">Entrega:</p>
                </div>
                <div class="d-flex flex-grow-1">
                    <p class="text-monospace mb-2 flex-grow-1 align-self-stretch">Saldo actual:</p>
                </div>
            </div>
        }
    </div>
    <button onclick="convertToPDF()">Convertir a PDF</button>
</div>
<script>
    function convertToPDF() {
        // Crea una nueva instancia de jsPDF
        const pdf = new jsPDF();

        // Obtiene el contenido HTML que deseas convertir
        const content = document.getElementById('contentToConvert');

        // Convierte el contenido HTML a PDF
        pdf.html(content, {
            callback: function (pdf) {
                // Guarda el PDF
                pdf.save('contenido.pdf');
            }
        });
    }
</script>